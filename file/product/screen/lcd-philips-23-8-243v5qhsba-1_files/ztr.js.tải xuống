(()=>{"use strict";class t{static mapFunc=new Map([["CLICK_ID",t.getClickId],["CLICK_TEXT",t.getClickText],["CLICK_URL",t.getClickUrl],["CLICK_CLASSES",t.getClickClasses],["CLICK_ELEMENT",t.getClickElement],["PAGE_URL",t.getPageUrl],["PAGE_PATH",t.getPagePath]]);constructor(t){this.event=t}getVariableValue(e){return t.mapFunc.get(e)(this.event)}getAllVariableValue(){let e={};return t.mapFunc.forEach(((t,n)=>{e[n]=t(this.event)})),e}static getClickId(t){return t.target?.id}static getClickText(t){return t.target?.innerText}static getClickUrl(t){return function(t){for(;t;){if(t.href&&t.nodeName.match(/^a$/i))return t.href;t=t.parentNode}}(t.target)}static getClickClasses(t){return t.target?.className}static getClickElement(t){var e=t.composedPath?t.composedPath():t.path;if(e)return e.slice(0,e.length-2).map((t=>{let e=t.tagName?.toLowerCase();return t.classList?.forEach((t=>e+="."+t)),e})).reverse().join(" > ")}static getPageUrl(t){return window.location.href}static getPagePath(t){return window.location.pathname}}class e{constructor(t){this.name=t.name,this.action=t.action}isMatch(t,e){return t===this.action.type&&this.isMatchRules(e)}isMatchRules(t){for(let n of this.action.rules)if(!e.isMatchRule(n,t))return!1;return!0}static isMatchRule(e,n){let i=new t(n).getVariableValue(e.variable);if(null==i)return!1;switch(e.operator){case"CONTAINS":return i.includes(e.value);case"DOES_NOT_CONTAIN":return!i.includes(e.value);case"EQUAL":return i instanceof Array?i.join(" ")===e.value:i===e.value;default:return!1}}}const n="7711843404775064594",i="https://px.dmp.zaloapp.com",a="zdmp_pssid",r="zdmp_page_view",o=[].map((t=>new e(t))),s="ztr_debug",c="ztr_pixel",d={EVENT_VERIFY:"__ZDMP_VERIFY__",EVENT_INIT_UTM:"__ZDMP_INIT_UTM__",EVENT_INIT_PIXEL:"__ZDMP_INIT_PIXEL__"};function l(){var t;function e(){t!==window.location.href&&(t=window.location.href,document.dispatchEvent(new CustomEvent(r)))}function n(t,e){e.isMatchRules(t)&&window.ztr("track",e.name)}o.forEach((t=>{!function(t){switch(t.action.type){case"CLICK":document.addEventListener("click",(e=>{n(e,t)}),!0);break;case"PAGE_VIEW":document.addEventListener(r,(e=>{n(e,t)}))}}(t)})),window.history.pushState=new Proxy(window.history.pushState,{apply:(t,n,i)=>{t.apply(n,i),e()}}),window.history.replaceState=new Proxy(window.history.replaceState,{apply:(t,n,i)=>{t.apply(n,i),e()}}),window.onpopstate=function(t){e()},e()}const u=function(t){return Object.keys(t).filter((e=>null!==t[e]&&void 0!==t[e])).map((function(e){return[e,encodeURIComponent(t[e])].join("=")})).join("&")};class p{constructor(t){this.baseUrl=t,this.params={}}addParam(t,e){this.params[t]=e}addParams(t){Object.assign(this.params,t)}get(){let t=new Image;t.referrerPolicy="unsafe-url",t.src=this.baseUrl+u(this.params)}}function m(){var e=window.location.search;const a=new URLSearchParams(e),d=a.get(s)?a.get(s):sessionStorage.getItem(s),l=a.get(c)?a.get(c):sessionStorage.getItem(c);if(!d)return;String.prototype.format=function(){var t=arguments;return this.replace(/{([0-9]+)}/g,(function(e,n){return void 0===t[n]?e:t[n]}))},function(t){let e;e=t?t===n?`Pixel ${t} connected`:`Pixel ${t} not installed`:"Pixel debug not found";const i=document.createElement("iframe");i.srcdoc='<!DOCTYPE html>\n<html lang="en">\n<head>\n    <title>Zalo DMP Debug</title>\n    <style>\n\n        body {\n            margin: 0;\n            font-family: Roboto,Helvetica Neue,Helvetica,Arial,sans-serif\n        }\n        .panel {\n            border-color: #ddd;\n            color: #333;\n        }\n\n        .panel-default {\n            border-color: #ddd;\n        }\n\n        .panel {\n            background-color: #fff;\n            border-radius: 3px;\n        }\n\n        .panel-default > .panel-heading {\n            color: #fff;\n            background-color: #2196f3;\n            border-color: #ddd;\n        }\n\n        .panel-heading {\n            position: relative;\n            border-top-right-radius: 3px;\n            border-top-left-radius: 3px;\n        }\n\n        .panel-heading {\n            padding: 15px 20px;\n            border-bottom: 1px solid transparent;\n            border-top-right-radius: 2px;\n            border-top-left-radius: 2px;\n        }\n\n        .h1.panel-title, h1.panel-title {\n            font-size: 20px;\n        }\n\n        .panel-title {\n            position: relative;\n        }\n\n        .panel-title {\n            margin-top: 0;\n            margin-bottom: 0;\n            color: inherit;\n        }\n\n        .panel-body {\n            position: relative;\n            font-size: 13px;\n        }\n\n        .panel-body {\n            padding: 15px;\n        }\n    </style>\n</head>\n<body>\n<div class="panel panel-default">\n    <div class="panel-heading">\n        <h1 class="panel-title">Zalo DMP Pixel Debug<a class="heading-elements-toggle"><i class="icon-more"></i></a></h1>\n    </div>\n\n    <div class="panel-body" style="">\n        {0}\n    </div>\n</div>\n</body>\n</html>\n'.format(e),i.style="border: 0px !important; inset: auto 24px 24px auto !important; border-radius: 8px !important; box-shadow: rgba(0, 0, 0, 0.2) 0px 3px 5px -1px, rgba(0, 0, 0, 0.14) 0px 5px 8px 0px, rgba(0, 0, 0, 0.12) 0px 1px 14px 0px !important; clip: initial !important; display: inline !important; height: 100px !important; margin: 0px !important; max-width: 95% !important; opacity: 1 !important; padding: 0px !important; position: fixed !important; visibility: visible !important; width: 300px !important; z-index: 2147483647 !important;",document.body.appendChild(i),setTimeout((function(){i.contentWindow.document.body.onclick=()=>{i.parentNode.removeChild(i)}}),100)}(l),sessionStorage.setItem(s,d),sessionStorage.setItem(c,l),document.addEventListener("click",(t=>{u("CLICK",t)}),!0),document.addEventListener(r,(t=>{u("PAGE_VIEW",t)}));const u=function(e,a){let r=new t(a).getAllVariableValue(),c=[],l=[];o.forEach((t=>{t.isMatch(e,a)?c.push(t.name):l.push(t.name)}));let u=new p(i+"/tr_debug?");u.addParam("id",n),u.addParam("event",e),u.addParam("time",Date.now()),u.addParam(s,d),u.addParams(r),u.addParam("eventsFired",c),u.addParam("eventsNotFired",l),u.get()}}function g(){try{if(window.ZDMP&&window.ZDMP.version)throw new Error("Already loaded");window.ZDMP={getVisitorID:function(e){return t.getZDMPVisitorID(e)},version:"2023-10-04"};var t={_vid:void 0,getDomain:function(){const t=window.location.hostname.split(".");return t[t.length-2]+"."+t[t.length-1]},getCookie:function(t){let e=document.cookie.split(";"),n=t+"=";for(let t=0;t<e.length;t++){let i=e[t].trim();if(0===i.indexOf(n))return i.substring(n.length,i.length)}return""},setCookieThirdParty:function(t,e){try{const n=this.getDomain(),i=new Date(Date.now()+63072e6).toUTCString();return document.cookie=t+"="+e+"; expires="+i+"; path=/; domain="+n,!0}catch(t){return!1}},formatUrlParams:function(t){return Object.keys(t).filter((e=>null!==t[e]&&void 0!==t[e])).map((function(e){return[e,encodeURIComponent(t[e])].join("=")})).join("&")},updateCookieZDMP:function(t,e,n,i){const a=new XMLHttpRequest;a.addEventListener("readystatechange",(function(){4===this.readyState&&(200===this.status?n(this.responseText):i(this.status))})),a.open("POST",t),a.withCredentials=!0,a.setRequestHeader("content-type","application/x-www-form-urlencoded"),a.send(this.formatUrlParams(e))},loadCookieFirstParty:function(e){const n={vid:e};this.updateCookieZDMP(i+"/sdk",n,(function(e){let n=JSON.parse(e);n&&n.vid?(t._vid=n.vid,t.setCookieThirdParty(t.COOKIE_ZDMP_KEY,t._vid)):t._vid=t.getCookie(t.COOKIE_ZDMP_KEY),t.notifyEvent(t.EVENT_ZDMP_READY)}),(function(e){t._vid=t.getCookie(t.COOKIE_ZDMP_KEY),t.notifyEvent(t.EVENT_ZDMP_READY)}))},loadVisitorID:function(){const e=window.location.search;let n=new URLSearchParams(e).get("utm_uid");this.isFormatVID(n)||!this.getCookie(this.COOKIE_ZDMP_KEY)?this.loadCookieFirstParty(n):(this._vid=this.getCookie(this.COOKIE_ZDMP_KEY),t.notifyEvent(t.EVENT_ZDMP_READY))},notifyEvent:function(t){let e=new Event(t,{bubbles:!0,cancelable:!0});document.dispatchEvent(e)},regexIdentified:/^3000\.((\d+)|([^\.]+\.\d$))/,EVENT_ZDMP_READY:"zdmp-sdk-ready",COOKIE_ZDMP_KEY:"__zi_zdmp",isFormatVID:function(t){return this.regexIdentified.test(t)},getZDMPVisitorID:function(t){return"function"==typeof t&&(void 0!==this._vid?t(this._vid):document.addEventListener(this.EVENT_ZDMP_READY,(function(){t(this._vid)}))),this._vid}};t.loadVisitorID()}catch(t){console.error(t)}}!function t(e,r,o,s,c){if(e.ZDMP||o||g(),!o){const t=e.location.search,n=new URLSearchParams(t),i=n.get("utm_cid"),a=n.get("utm_source"),o=n.get("utm_medium"),s=n.get("utm_campaign"),c=n.get("utm_audience"),u=n.get("utm_custom_segment");if(a){const t={utm_cid:i,utm_source:a,utm_medium:o,utm_campaign:s,utm_audience:c,utm_custom_segment:u,utm_ref:r.referrer?.replace(/(^\w+:|^)\/\//,"")};e.ztr("track",d.EVENT_INIT_UTM,t)}m(),l(),n.get("ztr_verify")&&e.ztr("track",d.EVENT_VERIFY)}if(!e.ZA){o||((c=r.createElement("script")).type="text/javascript",c.src="https://za.zdn.vn/v3/za.js?v=2.0",c.async=!1,(s=r.getElementsByTagName("script")[0]).parentNode.insertBefore(c,s),o=setInterval((function(){t(e,r,o)}),2e3));var p=e.ztr.queue||[];return e.ztr=function(t,n,i){e.ztr.queue.push({action:"track",event:n?String(n):"",arguments:Object.assign({},i)})},void(e.ztr.queue=p||[])}o&&clearInterval(o);var h=e.ztr.queue||[];e.ztr=function(a,o,s){switch(a){case"init":localStorage.setItem("zdmp_pid",""+o);break;case"track":if(!e.ZA)return e.ztr.queue=e.ztr.queue||[],e.ztr.queue.push({action:"track",event:o?String(o):"",arguments:Object.assign({},s)}),void t(e,r);let c={};c.id=n,c.event=o,Object.values(d).includes(o)?c=Object.assign(c,s):f(c,s),c.sessionId=_(),c.time=Date.now(),c.version="2.0",c.zscript=1,e.ZA.getVisitorID((function(t){c.utm_uid=t,e.ZDMP.getVisitorID((t=>{c.vidDmp=t;let e=new Image;e.referrerPolicy="unsafe-url",e.src=i+"/tr?"+u(c)}))}));break;default:console.log("Unsupported action: "+a)}},ztr.callMethod=ztr;const f=function(t,e){Object.keys(e||{}).forEach((n=>{t["p["+n+"]"]=e[n]}))},_=function(){let t=sessionStorage.getItem(a);return t||(t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){let e=16*Math.random()|0;return("x"===t?e:11&e).toString(16)})),sessionStorage.setItem(a,t)),t};h.length&&(h.forEach((function(t){ztr(t.action,t.event,t.arguments)})),e.ztr.queue=[])}(window,document)})();
